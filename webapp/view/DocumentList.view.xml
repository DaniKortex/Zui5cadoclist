<mvc:View controllerName="zui5cadoclist.controller.DocumentList"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:table="sap.ui.table"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:f="sap.f">
    <f:DynamicPage id="idDocumentListDynamicPage" showFooter="true">
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title id="idDocumentosDigitalizadosTitle" text="Documentos digitalizados" level="H2"/>
                </f:heading>
                <f:actions>
                    <Toolbar id="idHeaderToolbar" design="Transparent">
                        <ToolbarSpacer id="idSpacerToolbar1"/>
                        <Button id="idRefreshButton" icon="sap-icon://refresh" 
                               tooltip="{i18n>refresh}" 
                               press=".onRefresh"/>
                    </Toolbar>
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>
        <f:content>
            <Panel id="idDocumentsPanel" class="sapUiResponsiveMargin">
                <content>
                    <!-- Smart Filter Bar (basic) -->
                    <smartFilterBar:SmartFilterBar id="idSmartFilterBar"
                                                  entitySet="PdfListSet"
                                                  useToolbar="true">
                        <smartFilterBar:controlConfiguration>
                            <smartFilterBar:ControlConfiguration id="idDocIdControlConfiguration" key="DocId" visible="true" visibleInAdvancedArea="false"/>
                            <smartFilterBar:ControlConfiguration id="idUsernameControlConfiguration" key="Username" visible="true" visibleInAdvancedArea="false"/>
                            <smartFilterBar:ControlConfiguration id="idTypeDocControlConfiguration" key="TypeDoc" visible="true" visibleInAdvancedArea="false"/>
                        </smartFilterBar:controlConfiguration>
                    </smartFilterBar:SmartFilterBar>
                    <!-- Documents sap.ui.table.Table -->
                    <table:Table id="idDocumentsTable"
                                 rows="{ path: '/PdfListSet', parameters: { operationMode: 'Server' } }"
                                 visibleRowCount="20"
                                 busyIndicatorDelay="{viewModel>/delay}"
                                 busy="{viewModel>/busy}"
                                 selectionMode="Single"
                                 selectionBehavior="Row"
                                 rowSelectionChange=".onRowSelectionChange">
                        <table:columns>
                            <!-- ID -->
                            <table:Column id="idDocIdColumn" width="7rem" sortProperty="DocId">
                                <Label id="idDocIdColLabel" text="{i18n>docId}"/>
                                <table:label>
                                    <HBox id="idDocIdHeaderHBox">
                                        <Text id="idDocIdHeaderText" text="{i18n>docId}"/>
                                    </HBox>
                                </table:label>
                                <table:template>
                                    <ObjectIdentifier id="idDocIdObjectIdentifier" title="{DocId}"/>
                                </table:template>
                            </table:Column>
                            <!-- Nombre de fichero -->
                            <table:Column id="idFileNameColumn" width="16rem">
                                <Label id="idFileNameLabel" text="Nombre de fichero"/>
                                <table:template>
                                    <Text id="idFileNameText" text="{FileName}"/>
                                </table:template>
                            </table:Column>
                            <!-- Destino -->
                            <table:Column id="idDestinationColumn" width="10rem">
                                <Label id="idDestinationLabel" text="Destino"/>
                                <table:template>
                                    <Input id="idDestinationInput" value="{Destination}" showValueHelp="true" valueHelpRequest=".onDestinationValueHelp" editable="{ path: 'Error', formatter: '.formatDestinationEditable' }" />
                                </table:template>
                            </table:Column>
                            <!-- DescripciÃ³n -->
                            <table:Column id="idObjectDescColumn" width="9rem">
                                    <Label id="idObjectDescLabel" text="Tipo de Objeto"/>
                                <table:template>
                                    <Text id="idObjectDescText" text="{ObjectDescription}" maxLines="2"/>
                                </table:template>
                            </table:Column>
                            <!-- Tipo de Documento -->
                            <!-- Key (ObjKey) -->
                            <table:Column id="idObjKeyColumn" width="14rem">
                                <Label text="Clave Objeto"/>
                                <table:template>
                                    <HBox>
                                        <!-- ObjKey as plain text (not clickable) -->
                                        <Text id="idObjKeyText" text="{ObjKey}" />
                                        <!-- Edit button opens the same dialog as before; visible only when allowed -->
                    <Button id="idObjKeyEditButton"
                        icon="sap-icon://edit"
                        type="Transparent"
                        tooltip="Editar"
                        visible="{ parts: [{path: 'Error'}, {path: 'ObjKey'}, {path: 'Destination'}], formatter: '.formatEditVisible' }"
                        press=".onObjKeyLinkPress"/>
                                    </HBox>
                                </table:template>
                            </table:Column>
                            <!-- Usuario -->
                            <table:Column id="idUsernameColumn" width="10rem">
                                <Label id="idUsernameLabel" text="{i18n>username}"/>
                                <table:template>
                                    <Text id="idUsernameText" text="{Username}"/>
                                </table:template>
                            </table:Column>
                            <!-- Modificado -->
                            <table:Column id="idModifiedAtColumn" width="9rem" sortProperty="ModifiedAt">
                                <table:label>
                                    <HBox id="idModifiedAtHeaderHBox">
                                        <Text id="idModifiedAtHeaderText" text="{i18n>modifiedAt}"/>
                                    </HBox>
                                </table:label>
                                <table:template>
                                    <Text id="idModifiedAtText" text="{ path: 'ModifiedAt', type: 'sap.ui.model.odata.type.DateTime', formatOptions: { pattern: 'dd.MM.yyyy HH:mm' } }"/>
                                </table:template>
                            </table:Column>
                            <!-- Error (oculto) -->
                            <table:Column id="idErrorColumn" width="5rem" visible="false">
                                <Label id="idErrorLabel" text="{i18n>error}"/>
                                <table:template>
                                    <ObjectStatus id="idErrorObjectStatus" text="{path: 'Error', formatter: '.formatErrorText'}" state="{path: 'Error', formatter: '.formatErrorState'}"/>
                                </table:template>
                            </table:Column>
                            <!-- Acciones -->
                            <table:Column id="idActionsColumn" width="6rem">
                                <Label id="idActionsLabel" text="{i18n>actions}"/>
                                <table:template>
                                    <HBox>
                    <!-- Row-level visualize (eye) button: opens PDF for this row without selecting the table row -->
                    <Button id="idRowVisualizeButton"
                        icon="sap-icon://show"
                        type="Transparent"
                        tooltip="{i18n>visualize}"
                        press=".onRowVisualizePress"/>
                                        <Button id="idDownloadButton" icon="sap-icon://download" type="Transparent" tooltip="{i18n>download}" press=".onDownloadDocument"/>
                                    </HBox>
                                </table:template>
                            </table:Column>
                            <!-- Status -->
                            <table:Column id="idStatusColumn" width="6rem">
                                <Label id="idStatusLabel" text="Status"/>
                                <table:template>
                                    <!-- Ahora mapeamos el Status desde el campo Error -->
                                    <Text id="idStatusText" text="{path: 'Error', formatter: '.formatStatusText'}"/>
                                </table:template>
                            </table:Column>
                        </table:columns>
                    </table:Table>
                </content>
            </Panel>
        </f:content>
        <!-- Footer removed: per-row visualize button exists in the Actions column -->
    </f:DynamicPage>
</mvc:View>
